var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNativeSlider=_interopRequireDefault(require("react-native-slider"));var _reactNative=require("react-native");var _WebView=require("./WebView");var _constants=require("./constants");var _events=require("events");var _PlayerScripts=require("./PlayerScripts");var _this=this,_jsxFileName="/Users/qa/Documents/code/react-native-youtube-iframe/src/YoutubeIframe.js";var YoutubeIframe=function YoutubeIframe(props,ref){var height=props.height,width=props.width,videoId=props.videoId,playList=props.playList,_props$play=props.play,play=_props$play===void 0?false:_props$play,_props$mute=props.mute,mute=_props$mute===void 0?false:_props$mute,_props$volume=props.volume,volume=_props$volume===void 0?100:_props$volume,webViewStyle=props.webViewStyle,webViewProps=props.webViewProps,_props$playbackRate=props.playbackRate,playbackRate=_props$playbackRate===void 0?1:_props$playbackRate,_props$contentScale=props.contentScale,contentScale=_props$contentScale===void 0?1.0:_props$contentScale,_props$onError=props.onError,onError=_props$onError===void 0?function(_err){}:_props$onError,_props$onReady=props.onReady,onReady=_props$onReady===void 0?function(_event){}:_props$onReady,_props$playListStartI=props.playListStartIndex,playListStartIndex=_props$playListStartI===void 0?0:_props$playListStartI,_props$initialPlayerP=props.initialPlayerParams,initialPlayerParams=_props$initialPlayerP===void 0?{}:_props$initialPlayerP,_props$allowWebViewZo=props.allowWebViewZoom,allowWebViewZoom=_props$allowWebViewZo===void 0?false:_props$allowWebViewZo,_props$forceAndroidAu=props.forceAndroidAutoplay,forceAndroidAutoplay=_props$forceAndroidAu===void 0?false:_props$forceAndroidAu,_props$onChangeState=props.onChangeState,onChangeState=_props$onChangeState===void 0?function(_event){}:_props$onChangeState,_props$onFullScreenCh=props.onFullScreenChange,onFullScreenChange=_props$onFullScreenCh===void 0?function(_status){}:_props$onFullScreenCh,_props$onPlaybackQual=props.onPlaybackQualityChange,onPlaybackQualityChange=_props$onPlaybackQual===void 0?function(_quality){}:_props$onPlaybackQual,_props$onPlaybackRate=props.onPlaybackRateChange,onPlaybackRateChange=_props$onPlaybackRate===void 0?function(_playbackRate){}:_props$onPlaybackRate,_props$allowOnlyPlayP=props.allowOnlyPlayPauseOption,allowOnlyPlayPauseOption=_props$allowOnlyPlayP===void 0?false:_props$allowOnlyPlayP,_props$customSliderTr=props.customSliderTrackColor,customSliderTrackColor=_props$customSliderTr===void 0?"grey":_props$customSliderTr,_props$customSliderTh=props.customSliderThumbColor,customSliderThumbColor=_props$customSliderTh===void 0?"white":_props$customSliderTh,_props$onCustomSlider=props.onCustomSliderChange,onCustomSliderChange=_props$onCustomSlider===void 0?null:_props$onCustomSlider,_props$onCustomSlider2=props.onCustomSliderChangeCompleted,onCustomSliderChangeCompleted=_props$onCustomSlider2===void 0?null:_props$onCustomSlider2;var insertIf=function insertIf(condition){for(var _len=arguments.length,elements=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){elements[_key-1]=arguments[_key];}return condition?elements:[];};var _useState=(0,_react.useState)(play),_useState2=(0,_slicedToArray2.default)(_useState,2),playpauseonly=_useState2[0],setPlayPause=_useState2[1];var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2.default)(_useState3,2),playpausesingletap=_useState4[0],setPlayPauseSingleTap=_useState4[1];var _useState5=(0,_react.useState)(false),_useState6=(0,_slicedToArray2.default)(_useState5,2),canSlide=_useState6[0],setSliderVisibility=_useState6[1];var _useState7=(0,_react.useState)(0),_useState8=(0,_slicedToArray2.default)(_useState7,2),sliderPosition=_useState8[0],setSliderPosition=_useState8[1];var webViewRef=(0,_react.useRef)(null);var eventEmitter=(0,_react.useRef)(new _events.EventEmitter());var _useState9=(0,_react.useState)(false),_useState10=(0,_slicedToArray2.default)(_useState9,2),playerReady=_useState10[0],setPlayerReady=_useState10[1];(0,_react.useImperativeHandle)(ref,function(){return{getVideoUrl:function getVideoUrl(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.getVideoUrlScript);return new Promise(function(resolve){eventEmitter.current.once('getVideoUrl',resolve);});},getDuration:function getDuration(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.durationScript);return new Promise(function(resolve){eventEmitter.current.once('getDuration',resolve);});},getCurrentTime:function getCurrentTime(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.currentTimeScript);return new Promise(function(resolve){eventEmitter.current.once('getCurrentTime',resolve);});},isMuted:function isMuted(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.isMutedScript);return new Promise(function(resolve){eventEmitter.current.once('isMuted',resolve);});},getVolume:function getVolume(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.getVolumeScript);return new Promise(function(resolve){eventEmitter.current.once('getVolume',resolve);});},getPlaybackRate:function getPlaybackRate(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.getPlaybackRateScript);return new Promise(function(resolve){eventEmitter.current.once('getPlaybackRate',resolve);});},getAvailablePlaybackRates:function getAvailablePlaybackRates(){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.getAvailablePlaybackRatesScript);return new Promise(function(resolve){eventEmitter.current.once('getAvailablePlaybackRates',resolve);});},seekTo:function seekTo(seconds,allowSeekAhead){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.seekToScript(seconds,allowSeekAhead));}};},[]);(0,_react.useEffect)(function(){if(!playerReady){return;}[_PlayerScripts.playMode[play||playpauseonly],_PlayerScripts.soundMode[mute],_PlayerScripts.PLAYER_FUNCTIONS.setVolume(volume),_PlayerScripts.PLAYER_FUNCTIONS.setPlaybackRate(playbackRate)].forEach(webViewRef.current.injectJavaScript);},[play,playpauseonly,playerReady,mute,volume,playbackRate]);var onWebMessage=(0,_react.useCallback)(function(event){var message=JSON.parse(event.nativeEvent.data);try{switch(message.eventType){case'fullScreenChange':onFullScreenChange(message.data);break;case'playerStateChange':onChangeState(_constants.PLAYER_STATES[message.data]);break;case'playerReady':onReady();setPlayerReady(true);if(Array.isArray(playList)){webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.loadPlaylist(playList,playListStartIndex,play));}break;case'playerQualityChange':onPlaybackQualityChange(message.data);break;case'playerError':onError(_constants.PLAYER_ERROR[message.data]);break;case'playbackRateChange':onPlaybackRateChange(message.data);break;default:eventEmitter.current.emit(message.eventType,message.data);break;}}catch(error){console.warn(error);}},[play,onReady,onError,playList,onChangeState,onFullScreenChange,playListStartIndex,onPlaybackRateChange,onPlaybackQualityChange]);var handleCustomSliderChangeCompleted=function handleCustomSliderChangeCompleted(event){if(onCustomSliderChangeCompleted){onCustomSliderChangeCompleted(event);}};var handleCustomSliderChange=function handleCustomSliderChange(value){setSliderPosition(value);webViewRef.current.injectJavaScript(_PlayerScripts.PLAYER_FUNCTIONS.seekToScript(69,true));if(onCustomSliderChange){onCustomSliderChange(value);}};var onPlayPauseSingleTap=function onPlayPauseSingleTap(){console.log("single tap");if(playpauseonly){setPlayPauseSingleTap(!playpausesingletap);setSliderVisibility(!canSlide);}setPlayPause(!playpauseonly);};var onPlayPauseClick=function onPlayPauseClick(){setPlayPause(!playpauseonly);};var containerCss=[styles.playandpauseonly,insertIf(playpausesingletap,styles.playandpausesingletap)];return _react.default.createElement(_reactNative.View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:221,columnNumber:5}},allowOnlyPlayPauseOption&&_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_reactNative.TouchableOpacity,{style:[containerCss,{height:height}],onPress:onPlayPauseSingleTap,onLongPress:onPlayPauseClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:224,columnNumber:11}}),canSlide&&_react.default.createElement(_reactNativeSlider.default,{style:{position:"absolute",bottom:12,zIndex:10,width:"100%"},thumbStyle:{backgroundColor:customSliderThumbColor,height:25,borderRadius:0},trackStyle:{backgroundColor:customSliderTrackColor,height:15},value:sliderPosition,onValueChange:function onValueChange(value){return handleCustomSliderChange(value);},onSlidingComplete:function onSlidingComplete(event){return handleCustomSliderChangeCompleted(event);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:229,columnNumber:24}})),_react.default.createElement(_reactNative.View,{style:{height:height,width:width},__self:_this,__source:{fileName:_jsxFileName,lineNumber:254,columnNumber:7}},_react.default.createElement(_WebView.WebView,(0,_extends2.default)({originWhitelist:['*'],allowsInlineMediaPlayback:true,style:[styles.webView,webViewStyle],mediaPlaybackRequiresUserAction:false,allowsFullscreenVideo:!(initialPlayerParams==null?void 0:initialPlayerParams.preventFullScreen),userAgent:forceAndroidAutoplay?_reactNative.Platform.select({android:_constants.CUSTOM_USER_AGENT,ios:''}):'',onShouldStartLoadWithRequest:function onShouldStartLoadWithRequest(request){return request.mainDocumentURL==='about:blank';},bounces:false},webViewProps,{ref:webViewRef,onMessage:onWebMessage,source:(0,_extends2.default)({},webViewProps==null?void 0:webViewProps.source,{method:'GET',html:(0,_PlayerScripts.MAIN_SCRIPT)(videoId,playList,initialPlayerParams,allowWebViewZoom,contentScale)}),__self:_this,__source:{fileName:_jsxFileName,lineNumber:255,columnNumber:9}}))));};var styles=_reactNative.StyleSheet.create({webView:{backgroundColor:'transparent'},playandpauseonly:{zIndex:1,position:'absolute',bottom:0,width:'100%'},playandpausesingletap:{opacity:0.1,backgroundColor:'rgba(52, 52, 52, 0.4)'}});var _default=(0,_react.forwardRef)(YoutubeIframe);exports.default=_default;